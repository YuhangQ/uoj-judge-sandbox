## 关于为 UOJ 适配 simple-sandbox 中期报告

### 技术路线和项目分析

#### 适配存在的问题

UOJ 的评测机，主体使用 C++ 代码实现，使用 ptrace 对正在评测的程序进行控制。同时使用 Python 处理和 UOJ 的 WebAPI 的交互。

而需要适配的 simple-sandbox 是一个 node 模块(C++ 开发)，因此最好使用 nodeJS 在此基础上进行开发。

如果在原有代码的基础上进行修改，那么会遇到很大的问题。由于原有代码的所有评测逻辑是由 C++ 实现的且耦合性特别高，修改 C++ 代码让其调用 node 模块会比较麻烦，同时原代码都是为了 ptrace 设计的，这样需要作出大量的修改，付出大量时间最后的效果可能也不好，代码会变的更加难以维护。

#### 完全重写评测机

经过考虑，使用 node 技术栈重写评测机是一个较好的决定，出于下面的考虑：

1. node 技术栈对于 Web 支持是特别好的，用于替代 Python 和 UOJ 进行交互没有任何问题，甚至于会更好。
2. 评测逻辑并不是特别的复杂(尽管原有的C++代码特别复杂)，只需要支持少数几种编程语言和确定的几种题型即可，使用 node 可以快速开发，并且可维护性会更好。
3. node 可以直接调用 simple-sandbox，原生使用，效果非常好。

所以，整个评测机使用 node 技术栈一种就可以全部实现想要的功能了，非常统一和简洁又易于维护和二次开发。

### 中期成果

项目使用 TypeScript 进行开发，编译成 nodeJS。

![image-20210813191903644](https://7cow.wento.icu/image-20210813191903644.png)

#### 目前已实现的功能

1. 普通输入输出题目的测评
2. 自定义测试的测评
3. 额外测试的测评
4. 比赛模式测评
5. hack他人代码
6. 自定义 val 输入数据检测器(包含在 hack 中)
7. 自定义 chk 自定义 spj(包含在 hack 中)

> 请参考附录中的演示视频

#### 未实现功能

1. 支持提交答案题、通信题等更为复杂的题型。
2. 部分行为和 UOJ 原评测机有所差异，待修正。
3. 多语言支持，目前仅支持C++，但编码时考虑了多语言的设计，所以较容易实现。

### 总结

项目可以如期完工，目前已经做好了大部分的工作。完工后还会再优化一下代码，希望这个版本的评测机能够被其他人使用。

